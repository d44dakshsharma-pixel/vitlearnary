<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VITLearnary - Multi-User Academic Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --vit-blue: #00356b;
            --vit-orange: #ff6c00;
            --vit-light-blue: #0072ce;
            --vit-light-gray: #f5f5f5;
            --vit-dark: #212529;
            --vit-success: #28a745;
            --vit-warning: #ffc107;
            --vit-danger: #dc3545;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: var(--vit-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--vit-blue), var(--vit-light-blue));
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--vit-blue);
            font-size: 20px;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
        }

        .logo-subtext {
            font-size: 12px;
            opacity: 0.9;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: 4px;
        }

        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .user-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--vit-blue);
        }

        .btn-primary {
            background: var(--vit-orange);
            color: white;
        }

        .btn-primary:hover {
            background: #e55d00;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* Auth Modals */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .auth-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--vit-dark);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--vit-light-gray);
            justify-content: center;
        }

        .auth-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--vit-dark);
            transition: var(--transition);
        }

        .auth-tab.active {
            color: var(--vit-blue);
            border-bottom: 3px solid var(--vit-blue);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--vit-light-gray);
            border-radius: 8px;
            font-size: 16px;
        }

        .form-error {
            color: var(--vit-danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        /* Password Strength */
        .password-strength {
            height: 5px;
            margin-top: 8px;
            border-radius: 3px;
            background: #eee;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s ease;
        }

        .password-strength-text {
            font-size: 12px;
            margin-top: 4px;
            text-align: right;
        }

        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(to right, #ff9d00, var(--vit-orange));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-info {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--card-shadow);
            z-index: 100;
            min-width: 200px;
            color: var(--vit-dark);
        }

        .user-info.active {
            display: block;
        }

        .user-info p {
            margin-bottom: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            background: var(--vit-success);
            box-shadow: var(--card-shadow);
            z-index: 1000;
            display: none;
            transform: translateY(100px);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .notification.error {
            background: var(--vit-danger);
        }

        .notification.warning {
            background: var(--vit-warning);
        }

        .notification.show {
            display: block;
            transform: translateY(0);
        }

        /* Main Content Sections */
        .hero {
            background: linear-gradient(to right, var(--vit-blue), var(--vit-light-blue));
            color: white;
            padding: 80px 0;
            text-align: center;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
            font-size: 2.5rem;
            color: var(--vit-blue);
        }

        .features {
            padding: 80px 0;
            background: white;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: var(--vit-light-gray);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-10px);
        }

        .feature-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(to right, var(--vit-blue), var(--vit-light-blue));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 28px;
        }

        /* Resources Section */
        .resources {
            padding: 80px 0;
            background: white;
        }

        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .search-input {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid var(--vit-light-gray);
            border-radius: 8px;
            font-size: 16px;
            min-width: 200px;
        }

        .filter-select {
            padding: 12px;
            border: 1px solid var(--vit-light-gray);
            border-radius: 8px;
            font-size: 16px;
            background: white;
            min-width: 150px;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .resource-card {
            background: var(--vit-light-gray);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
        }

        .resource-card:hover {
            transform: translateY(-5px);
        }

        .resource-img {
            height: 160px;
            background: linear-gradient(to right, var(--vit-blue), var(--vit-light-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 50px;
        }

        .resource-content {
            padding: 20px;
        }

        .resource-content h3 {
            margin-bottom: 10px;
            color: var(--vit-blue);
        }

        .resource-meta {
            display: flex;
            justify-content: space-between;
            color: var(--vit-dark);
            opacity: 0.8;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .resource-actions {
            display: flex;
            justify-content: space-between;
        }

        /* Dashboard Section */
        .dashboard {
            padding: 80px 0;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: var(--vit-light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--vit-blue);
            font-size: 24px;
        }

        .stat-details h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .stat-details p {
            color: var(--vit-dark);
            opacity: 0.8;
            font-size: 14px;
        }

        /* Upload Section */
        .file-validation {
            background: var(--vit-light-gray);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .file-validation h3 {
            color: var(--vit-warning);
            margin-bottom: 10px;
        }

        .validation-criteria {
            margin-left: 20px;
            margin-top: 10px;
        }

        .validation-criteria li {
            margin-bottom: 8px;
        }

        .upload-form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
        }

        .file-info {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 14px;
            color: var(--vit-dark);
            opacity: 0.8;
        }

        /* Preview Modal */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .preview-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--vit-light-gray);
        }

        .preview-body {
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .preview-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Loading Spinner */
        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--vit-blue);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        footer {
            background: var(--vit-blue);
            color: white;
            padding: 60px 0 30px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--vit-orange);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            color: var(--vit-orange);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .delete-btn {
    background: var(--vit-danger) !important;
    color: white !important;
    border: none !important;
    transition: var(--transition);
}

.delete-btn:hover {
    background: #c82333 !important;
    transform: translateY(-2px);
}

.resource-actions {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
}

.resource-actions .btn {
    flex: 1;
    min-width: 80px;
}

/* Hide Admin link by default - will be shown only for Daksh */
nav ul li:nth-child(5) {
    display: none;
}

        /* Responsive Design */
        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                gap: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .section-title {
                font-size: 2rem;
            }
            
            .search-bar {
                flex-direction: column;
            }

            .preview-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Auth Modals -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="close-modal" id="closeModal">&times;</button>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
    <label for="loginEmail">VIT Bhopal Email</label>
    <input type="email" id="loginEmail" placeholder="Enter your @vitbhopal.ac.in email" required>
    <div class="form-error" id="loginEmailError"></div>
</div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    <div class="form-error" id="loginPasswordError"></div>
                </div>
                
                <div class="form-group" style="display: flex; align-items: center;">
                    <input type="checkbox" id="rememberMe" style="width: auto; margin-right: 10px;">
                    <label for="rememberMe" style="margin: 0;">Remember me</label>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                
                <p style="text-align: center; margin-top: 20px;">
                    <a href="#" id="forgotPasswordLink" style="color: var(--vit-blue);">Forgot password?</a>
                </p>
            </form>
            
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" placeholder="Enter your full name" required>
                    <div class="form-error" id="signupNameError"></div>
                </div>
                
                <div class="form-group">
    <label for="signupEmail">VIT Bhopal Email</label>
    <input type="email" id="signupEmail" placeholder="Enter your @vitbhopal.ac.in email" required>
    <div class="form-error" id="signupEmailError"></div>
</div>
                
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Create a password" required>
                    <div class="password-strength">
                        <div class="password-strength-bar" id="passwordStrengthBar"></div>
                    </div>
                    <div class="password-strength-text" id="passwordStrengthText"></div>
                    <div class="form-error" id="signupPasswordError"></div>
                </div>
                
                <div class="form-group">
                    <label for="signupRole">I am a</label>
                    <select id="signupRole" required>
                        <option value="">Select Role</option>
                        <option value="student">Student</option>
                        <option value="faculty">Faculty</option>
                    </select>
                    <div class="form-error" id="signupRoleError"></div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
            </form>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-content">
            <div class="preview-header">
                <h2 id="previewTitle">Resource Preview</h2>
                <button class="close-modal" id="closePreview">&times;</button>
            </div>
            <div class="preview-body" id="previewBody">
                <!-- Preview content will be inserted here -->
            </div>
            <div class="preview-footer">
                <button class="btn btn-outline" id="closePreviewBtn">Close</button>
                <button class="btn btn-primary" id="downloadPreviewBtn">Download</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-img">VL</div>
                    <div>
                        <div class="logo-text">VITLearnary</div>
                        <div class="logo-subtext">Multi-User Academic Platform</div>
                    </div>
                </div>
                
                <nav>
                    <ul>
                        <li><a href="#" class="active">Home</a></li>
                        <li><a href="#resources">Resources</a></li>
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#upload">Upload</a></li>
                        <li><a href="#admin">Admin</a></li>
                        <li><a href="#about">About</a></li>
                    </ul>
                </nav>
                
                <div class="user-actions">
                    <div class="user-profile" id="userProfile" style="display: none;">
                        <div class="user-avatar" id="userAvatar">JD</div>
                        <div class="user-info" id="userInfo">
                            <p>Welcome, <span id="userName">John Doe</span></p>
                            <p>Role: <span id="userRole">Student</span></p>
                            <button class="btn btn-sm btn-primary" id="logoutBtn" style="width: 100%; margin-top: 10px;">Logout</button>
                        </div>
                    </div>
                    <button class="btn btn-outline" id="loginBtn">Login</button>
                    <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 style="font-size: 3rem; margin-bottom: 20px;">Welcome to VITLearnary</h1>
            <p style="font-size: 1.2rem; max-width: 700px; margin: 0 auto 30px;">
                A comprehensive academic platform for VIT students and faculty to share resources, collaborate, and enhance learning experiences.
            </p>
            <button class="btn btn-primary" style="font-size: 1.1rem; padding: 12px 30px;">Get Started</button>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2 class="section-title">Key Features</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3>Resource Sharing</h3>
                    <p>Share and access study materials, notes, and research papers with the VIT community.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>Collaborative Learning</h3>
                    <p>Connect with peers and faculty for group studies, discussions, and academic projects.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Performance Tracking</h3>
                    <p>Monitor your academic progress with detailed analytics and personalized insights.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Resources Section -->
    <section class="resources" id="resources">
        <div class="container">
            <h2 class="section-title">Academic Resources</h2>
            
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Search resources..." id="resourceSearch">
                <select class="filter-select" id="courseFilter">
                    <option value="">All Courses</option>
                    <option value="cse">Computer Science</option>
                    <option value="ece">Electronics</option>
                    <option value="mech">Mechanical</option>
                    <option value="it">IT</option>
                </select>
                <select class="filter-select" id="semesterFilter">
                    <option value="">All Semesters</option>
                    <option value="1">Semester 1</option>
                    <option value="2">Semester 2</option>
                    <option value="3">Semester 3</option>
                    <option value="4">Semester 4</option>
                </select>
                <select class="filter-select" id="typeFilter">
                    <option value="">All Types</option>
                    <option value="notes">Notes</option>
                    <option value="book">Books</option>
                    <option value="paper">Question Papers</option>
                    <option value="project">Projects</option>
                </select>
            </div>
            
            <div class="resources-grid" id="resourcesGrid">
                <!-- Resources will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard">
        <div class="container">
            <h2 class="section-title">Your Dashboard</h2>
            
            <div class="dashboard-cards">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-upload"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="uploadsCount">0</h3>
                        <p>Resources Uploaded</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="downloadsCount">0</h3>
                        <p>Total Downloads</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="ratingAvg">0.0</h3>
                        <p>Average Rating</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="contributorsCount">0</h3>
                        <p>Active Contributors</p>
                    </div>
                </div>
            </div>
            
            <h3 style="text-align: center; margin-bottom: 30px;">Your Recent Uploads</h3>
            <div class="resources-grid" id="userResourcesGrid">
                <!-- User resources will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Upload Section -->
    <section class="resources" id="upload">
        <div class="container">
            <h2 class="section-title">Upload Resource</h2>
            
            <div class="file-validation">
                <h3><i class="fas fa-exclamation-circle"></i> Before You Upload</h3>
                <p>Please ensure your resource meets the following criteria:</p>
                <ul class="validation-criteria">
                    <li>File size should not exceed 25MB</li>
                    <li>Only PDF, DOC, DOCX, PPT, PPTX files are allowed</li>
                    <li>Content must be relevant to VIT curriculum</li>
                    <li>No copyrighted material unless you have permission</li>
                    <li>Provide accurate metadata for better discoverability</li>
                </ul>
            </div>
            
            <div class="upload-form">
                <form id="resourceUploadForm">
                    <div class="form-group">
                        <label for="resourceTitle">Resource Title</label>
                        <input type="text" id="resourceTitle" placeholder="Enter a descriptive title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceDescription">Description</label>
                        <textarea id="resourceDescription" rows="3" placeholder="Provide a brief description of the resource" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceCourse">Course</label>
                        <select id="resourceCourse" required>
                            <option value="">Select Course</option>
                            <option value="cse">Computer Science & Engineering</option>
                            <option value="ece">Electronics & Communication</option>
                            <option value="mech">Mechanical Engineering</option>
                            <option value="it">Information Technology</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceSemester">Semester</label>
                        <select id="resourceSemester" required>
                            <option value="">Select Semester</option>
                            <option value="1">Semester 1</option>
                            <option value="2">Semester 2</option>
                            <option value="3">Semester 3</option>
                            <option value="4">Semester 4</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceSubject">Subject</label>
                        <input type="text" id="resourceSubject" placeholder="Enter subject name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceType">Resource Type</label>
                        <select id="resourceType" required>
                            <option value="">Select Type</option>
                            <option value="notes">Notes</option>
                            <option value="book">Book</option>
                            <option value="paper">Question Paper</option>
                            <option value="project">Project</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceFile">Upload File</label>
                        <input type="file" id="resourceFile" required>
                        <div class="file-info">
                            <span id="fileName">No file chosen</span>
                            <span id="fileSize">Max 25MB</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">
                        <i class="fas fa-cloud-upload-alt"></i> Upload Resource
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- ADD ADMIN PANEL SECTION HERE -->
<section class="resources" id="admin" style="display: none;">
    <div class="container">
        <h2 class="section-title">Admin Panel</h2>
        
        <div class="admin-actions" style="text-align: center; margin-bottom: 30px;">
            <button class="btn btn-danger" id="viewAllUsersBtn" style="margin: 5px;">
                <i class="fas fa-users"></i> View All Users
            </button>
            <button class="btn btn-warning" id="cleanupOrphanedBtn" style="margin: 5px;">
                <i class="fas fa-trash"></i> Cleanup Orphaned Resources
            </button>
        </div>
        
        <div id="adminResults" style="margin-top: 20px;"></div>
    </div>
</section>

    <!-- Footer -->
    <footer id="about">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>VITLearnary</h3>
                    <p>A comprehensive academic platform for VIT students and faculty to share resources and collaborate.</p>
                </div>
                
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#resources">Resources</a></li>
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#upload">Upload</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <ul>
                        <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
                        <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
                        <li><a href="#"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 VITLearnary. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>

// Smart environment detection
const getApiBase = () => {
    const hostname = window.location.hostname;
    
    if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return 'http://localhost:5000/api';
    }
    
    if (hostname.includes('render.com')) {
        return `https://${hostname}/api`;
    }
    
    return '/api';
};

const API_BASE = getApiBase();
console.log('🔗 Backend URL:', API_BASE);

// DOM Elements
const authModal = document.getElementById('authModal');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const closeModal = document.getElementById('closeModal');
const authTabs = document.querySelectorAll('.auth-tab');
const authForms = document.querySelectorAll('.auth-form');
const loginForm = document.getElementById('loginForm');
const signupForm = document.getElementById('signupForm');
const userProfile = document.getElementById('userProfile');
const userInfo = document.getElementById('userInfo');
const logoutBtn = document.getElementById('logoutBtn');
const notification = document.getElementById('notification');
const resourcesGrid = document.getElementById('resourcesGrid');
const userResourcesGrid = document.getElementById('userResourcesGrid');
const resourceSearch = document.getElementById('resourceSearch');
const courseFilter = document.getElementById('courseFilter');
const semesterFilter = document.getElementById('semesterFilter');
const typeFilter = document.getElementById('typeFilter');
const resourceUploadForm = document.getElementById('resourceUploadForm');
const resourceFile = document.getElementById('resourceFile');
const fileName = document.getElementById('fileName');
const fileSize = document.getElementById('fileSize');
const previewModal = document.getElementById('previewModal');
const closePreview = document.getElementById('closePreview');
const closePreviewBtn = document.getElementById('closePreviewBtn');
const downloadPreviewBtn = document.getElementById('downloadPreviewBtn');
const passwordStrengthBar = document.getElementById('passwordStrengthBar');
const passwordStrengthText = document.getElementById('passwordStrengthText');
const signupPassword = document.getElementById('signupPassword');

// Current user state
let currentUser = null;
let currentPreviewResource = null;

// Admin: View all users
function viewAllUsers() {
    const token = localStorage.getItem('authToken');
    
    showNotification('Loading users...', 'success');
    
    fetch(`${API_BASE}/admin/users`, {
        headers: {
            'Authorization': token
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to fetch users');
        }
        return response.json();
    })
    .then(users => {
        const resultsDiv = document.getElementById('adminResults');
        resultsDiv.innerHTML = `
            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--card-shadow);">
                <h3 style="color: var(--vit-blue); margin-bottom: 20px;">All Users (${users.length})</h3>
                <div style="max-height: 500px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--vit-light-gray);">
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--vit-blue);">Name</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--vit-blue);">Email</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--vit-blue);">Role</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--vit-blue);">Joined</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--vit-blue);">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(user => `
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="padding: 12px;">${escapeHtml(user.name)}</td>
                                    <td style="padding: 12px;">${escapeHtml(user.email)}</td>
                                    <td style="padding: 12px;">
                                        <select class="role-select" data-user-id="${user.id}" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                                            <option value="student" ${user.role === 'student' ? 'selected' : ''}>Student</option>
                                            <option value="faculty" ${user.role === 'faculty' ? 'selected' : ''}>Faculty</option>
                                        </select>
                                    </td>
                                    <td style="padding: 12px;">${new Date(user.joined_date).toLocaleDateString()}</td>
                                    <td style="padding: 12px;">
                                        ${user.id !== currentUser.id ? `
                                            <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}', '${user.name}')" style="padding: 5px 10px;">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        ` : '<span style="color: #999;">Current User</span>'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        
        // Add event listeners for role changes
        document.querySelectorAll('.role-select').forEach(select => {
            select.addEventListener('change', function() {
                updateUserRole(this.getAttribute('data-user-id'), this.value);
            });
        });
    })
    .catch(error => {
        showNotification('Failed to fetch users', 'error');
        console.error('Error fetching users:', error);
    });
}

// Admin: Update user role
function updateUserRole(userId, newRole) {
    const token = localStorage.getItem('authToken');
    
    fetch(`${API_BASE}/admin/users/${userId}/role`, {
        method: 'PUT',
        headers: {
            'Authorization': token,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ role: newRole })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to update role');
        }
        return response.json();
    })
    .then(data => {
        showNotification(`User role updated to ${newRole}`, 'success');
    })
    .catch(error => {
        showNotification('Failed to update user role', 'error');
        console.error('Error updating role:', error);
    });
}

// Admin: Delete user
function deleteUser(userId, userName) {
    if (!confirm(`Are you sure you want to delete user "${userName}"? This will also delete all their resources!`)) {
        return;
    }
    
    const token = localStorage.getItem('authToken');
    
    fetch(`${API_BASE}/admin/users/${userId}`, {
        method: 'DELETE',
        headers: {
            'Authorization': token
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to delete user');
        }
        return response.json();
    })
    .then(data => {
        showNotification('User deleted successfully', 'success');
        viewAllUsers(); // Refresh the user list
    })
    .catch(error => {
        showNotification('Failed to delete user', 'error');
        console.error('Error deleting user:', error);
    });
}

// Admin: Cleanup orphaned resources
function cleanupOrphanedResources() {
    const token = localStorage.getItem('authToken');
    
    fetch(`${API_BASE}/admin/cleanup-orphaned`, {
        method: 'POST',
        headers: {
            'Authorization': token
        }
    })
    .then(response => response.json())
    .then(data => {
        showNotification(data.message, 'success');
        loadResources(); // Refresh resources
    })
    .catch(error => {
        showNotification('Cleanup failed', 'error');
    });
}

// Initialize the application
function init() {
    console.log("Initializing VITLearnary...");
    checkBackendHealth();
    checkLoggedIn();
    setupEventListeners();
    loadResources();
}

// Check backend health
function checkBackendHealth() {
    fetch(`${API_BASE}/health`)
        .then(response => response.json())
        .then(data => {
            console.log('Backend status:', data.status);
            if (data.status !== 'healthy') {
                showNotification('Backend connection issue', 'warning');
            }
        })
        .catch(error => {
            console.error('Backend health check failed:', error);
            showNotification('Cannot connect to server. Please ensure backend is running.', 'error');
        });
}

// Set up event listeners
function setupEventListeners() {
    // Auth modal
    loginBtn.addEventListener('click', () => showAuthModal('login'));
    signupBtn.addEventListener('click', () => showAuthModal('signup'));
    closeModal.addEventListener('click', hideAuthModal);
    
    // Auth tabs
    authTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchAuthTab(tabName);
        });
    });
    
    // Auth forms
    loginForm.addEventListener('submit', handleLogin);
    signupForm.addEventListener('submit', handleSignup);
    
    // User profile
    document.getElementById('userAvatar').addEventListener('click', toggleUserInfo);
    logoutBtn.addEventListener('click', handleLogout);
    
    // Close user info when clicking outside
    document.addEventListener('click', (e) => {
        if (!userProfile.contains(e.target)) {
            userInfo.classList.remove('active');
        }
    });

    // ADD THESE LINES FOR ADMIN BUTTONS:
    document.getElementById('viewAllUsersBtn')?.addEventListener('click', viewAllUsers);
    document.getElementById('cleanupOrphanedBtn')?.addEventListener('click', cleanupOrphanedResources);
    
    // Filters
    resourceSearch.addEventListener('input', debounce(filterResources, 300));
    courseFilter.addEventListener('change', filterResources);
    semesterFilter.addEventListener('change', filterResources);
    typeFilter.addEventListener('change', filterResources);
    
    // File upload
    resourceFile.addEventListener('change', updateFileInfo);
    resourceUploadForm.addEventListener('submit', handleResourceUpload);
    
    // Preview modal
    closePreview.addEventListener('click', hidePreviewModal);
    closePreviewBtn.addEventListener('click', hidePreviewModal);
    downloadPreviewBtn.addEventListener('click', handleDownloadPreview);
    
    // Password strength
    signupPassword.addEventListener('input', checkPasswordStrength);
    
    // Navigation smooth scroll with admin access control
document.querySelectorAll('nav a').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        
        // Check if clicking Admin link and user is not admin
        if (targetId === '#admin') {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('Access Denied. Only for Daksh Sharma', 'error');
                return;
            }
        }
        
        if (targetId !== '#') {
            document.querySelector(targetId).scrollIntoView({
                behavior: 'smooth'
            });
        }
    });
});
}

// Debounce function for search
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Check if user is logged in
function checkLoggedIn() {
    const user = JSON.parse(localStorage.getItem('currentUser'));
    const token = localStorage.getItem('authToken');
    
    if (user && token) {
        currentUser = user;
        updateUIForLoggedInUser();
    }
}

function updateUIForLoggedInUser() {
    loginBtn.style.display = 'none';
    signupBtn.style.display = 'none';
    userProfile.style.display = 'flex';
    
    // Set user info
    const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
    document.getElementById('userAvatar').textContent = initials;
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
    
    // Show admin panel and link only if user is Daksh Sharma
    const isDakshAdmin = currentUser.email === 'daksh.24bsa10265@vitbhopal.ac.in';
    
    if (isDakshAdmin) {
        document.getElementById('admin').style.display = 'block';
        // Show Admin link in navigation
        document.querySelector('a[href="#admin"]').parentElement.style.display = 'list-item';
    } else {
        // Hide Admin link from non-Daksh users
        document.querySelector('a[href="#admin"]').parentElement.style.display = 'none';
        document.getElementById('admin').style.display = 'none';
    }
    
    // Update dashboard stats
    updateDashboardStats();
}

// Update dashboard statistics
function updateDashboardStats() {
    if (!currentUser) return;
    
    fetch(`${API_BASE}/dashboard/stats`, {
        headers: {
            'Authorization': localStorage.getItem('authToken')
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to fetch stats');
        return response.json();
    })
    .then(data => {
        document.getElementById('uploadsCount').textContent = data.uploads_count;
        document.getElementById('downloadsCount').textContent = data.downloads_count;
        document.getElementById('ratingAvg').textContent = data.rating_avg;
        document.getElementById('contributorsCount').textContent = data.contributors_count;
    })
    .catch(error => {
        console.error('Error fetching dashboard stats:', error);
        showNotification('Failed to load dashboard statistics', 'error');
    });
    
    loadUserResources();
}

// Show auth modal
function showAuthModal(tab) {
    authModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    switchAuthTab(tab);
}

// Hide auth modal
function hideAuthModal() {
    authModal.style.display = 'none';
    document.body.style.overflow = 'auto';
    // Clear forms
    loginForm.reset();
    signupForm.reset();
}

// Switch auth tab
function switchAuthTab(tabName) {
    authTabs.forEach(tab => {
        if (tab.getAttribute('data-tab') === tabName) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });
    
    authForms.forEach(form => {
        if (form.id === `${tabName}Form`) {
            form.classList.add('active');
        } else {
            form.classList.remove('active');
        }
    });
}

// Handle login
function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    
    if (!email || !password) {
        showNotification('Please fill all fields', 'error');
        return;
    }
    
    // Check if email is from VIT Bhopal domain
    if (!email.endsWith('@vitbhopal.ac.in')) {
        showNotification('Only official VIT Bhopal email addresses (@vitbhopal.ac.in) are allowed', 'error');
        return;
    }
    
    showLoading(true);
    
    fetch(`${API_BASE}/auth/login`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, password })
    })
    .then(response => {
        if (!response.ok) throw new Error('Login failed');
        return response.json();
    })
    .then(data => {
        if (data.message === 'Login successful') {
            currentUser = data.user;
            localStorage.setItem('currentUser', JSON.stringify(data.user));
            localStorage.setItem('authToken', data.token);
            updateUIForLoggedInUser();
            hideAuthModal();
            showNotification('Login successful!', 'success');
        } else {
            showNotification(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Login error:', error);
        showNotification('Invalid email or password', 'error');
    })
    .finally(() => {
        showLoading(false);
    });
}

// Handle signup
function handleSignup(e) {
    e.preventDefault();
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPassword').value;
    const role = document.getElementById('signupRole').value;
    
    if (!name || !email || !password || !role) {
        showNotification('Please fill all fields', 'error');
        return;
    }
    
    // Check if email is from VIT Bhopal domain
    if (!email.endsWith('@vitbhopal.ac.in')) {
        showNotification('Only official VIT Bhopal email addresses (@vitbhopal.ac.in) are allowed', 'error');
        return;
    }
    
    if (password.length < 6) {
        showNotification('Password must be at least 6 characters', 'error');
        return;
    }
    
    showLoading(true);
    
    fetch(`${API_BASE}/auth/register`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name, email, password, role })
    })
    .then(response => {
        if (!response.ok) throw new Error('Registration failed');
        return response.json();
    })
    .then(data => {
        if (data.message === 'User created successfully') {
            currentUser = data.user;
            localStorage.setItem('currentUser', JSON.stringify(data.user));
            localStorage.setItem('authToken', data.token);
            updateUIForLoggedInUser();
            hideAuthModal();
            showNotification('Account created successfully!', 'success');
        } else {
            showNotification(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Signup error:', error);
        showNotification('Registration failed. Email may already exist.', 'error');
    })
    .finally(() => {
        showLoading(false);
    });
}

// Handle logout
function handleLogout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    localStorage.removeItem('authToken');
    loginBtn.style.display = 'block';
    signupBtn.style.display = 'block';
    userProfile.style.display = 'none';
    userInfo.classList.remove('active');

    // Hide Admin link when logging out
    document.querySelector('a[href="#admin"]').parentElement.style.display = 'none';
    document.getElementById('admin').style.display = 'none';

    showNotification('Logged out successfully', 'success');
    
    // Reload resources to show public view
    loadResources();
}

// Toggle user info dropdown
function toggleUserInfo(e) {
    e.stopPropagation();
    userInfo.classList.toggle('active');
}

// Show notification
function showNotification(message, type = 'success') {
    notification.textContent = message;
    notification.className = 'notification show';
    notification.classList.remove('error', 'warning', 'success');
    
    if (type === 'error') {
        notification.classList.add('error');
    } else if (type === 'warning') {
        notification.classList.add('warning');
    } else {
        notification.classList.add('success');
    }
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 4000);
}

// Show loading state
function showLoading(show) {
    const buttons = document.querySelectorAll('button[type="submit"]');
    buttons.forEach(button => {
        if (show) {
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        } else {
            button.disabled = false;
            if (button.closest('#loginForm')) {
                button.innerHTML = 'Login';
            } else if (button.closest('#signupForm')) {
                button.innerHTML = 'Create Account';
            } else if (button.closest('#resourceUploadForm')) {
                button.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Upload Resource';
            }
        }
    });
}

// Load resources from backend
function loadResources() {
    showResourcesLoading(true);
    
    const search = resourceSearch.value;
    const course = courseFilter.value;
    const semester = semesterFilter.value;
    const type = typeFilter.value;
    
    let url = `${API_BASE}/resources?`;
    const params = new URLSearchParams();
    
    if (search) params.append('search', search);
    if (course) params.append('course', course);
    if (semester) params.append('semester', semester);
    if (type) params.append('type', type);
    
    url += params.toString();
    
    console.log('Loading resources from:', url);
    
    fetch(url)
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(resources => {
        console.log('Received resources:', resources);
        resourcesGrid.innerHTML = '';
        
        if (resources.length === 0) {
            resourcesGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <i class="fas fa-search" style="font-size: 48px; color: var(--vit-light-blue); margin-bottom: 15px;"></i>
                    <h3>No resources found</h3>
                    <p>Try adjusting your search or filters</p>
                </div>
            `;
        } else {
            resources.forEach(resource => {
                const resourceCard = createResourceCard(resource);
                resourcesGrid.appendChild(resourceCard);
            });
        }
    })
    .catch(error => {
        console.error('Error loading resources:', error);
        resourcesGrid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--vit-warning); margin-bottom: 15px;"></i>
                <h3>Failed to load resources</h3>
                <p>Error: ${error.message}</p>
                <button class="btn btn-primary" onclick="loadResources()">Try Again</button>
            </div>
        `;
    })
    .finally(() => {
        showResourcesLoading(false);
    });
}

// Load user resources from backend
function loadUserResources() {
    if (!currentUser) return;
    
    fetch(`${API_BASE}/resources/user`, {
        headers: {
            'Authorization': localStorage.getItem('authToken')
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to fetch user resources');
        return response.json();
    })
    .then(resources => {
        userResourcesGrid.innerHTML = '';
        
        if (resources.length === 0) {
            userResourcesGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <i class="fas fa-upload" style="font-size: 48px; color: var(--vit-light-blue); margin-bottom: 15px;"></i>
                    <h3>No resources uploaded yet</h3>
                    <p>Start sharing your academic resources with the community!</p>
                </div>
            `;
        } else {
            resources.forEach(resource => {
                const resourceCard = createResourceCard(resource);
                userResourcesGrid.appendChild(resourceCard);
            });
        }
    })
    .catch(error => {
        console.error('Error loading user resources:', error);
        userResourcesGrid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--vit-warning); margin-bottom: 15px;"></i>
                <h3>Failed to load your resources</h3>
            </div>
        `;
    });
}

// Show resources loading state
function showResourcesLoading(show) {
    if (show) {
        resourcesGrid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <div class="spinner" style="display: block;"></div>
                <p>Loading resources...</p>
            </div>
        `;
    }
}

// Create resource card
function createResourceCard(resource) {
    const card = document.createElement('div');
    card.className = 'resource-card';
    
    // Check if current user is admin
    const isAdmin = currentUser && currentUser.role === 'admin';
    
    card.innerHTML = `
        <div class="resource-img">
            <i class="fas fa-file-${getFileIcon(resource.type)}"></i>
        </div>
        <div class="resource-content">
            <h3>${escapeHtml(resource.title)}</h3>
            <p>${escapeHtml(resource.description)}</p>
            <div class="resource-meta">
                <span>${escapeHtml(resource.subject)}</span>
                <span>${resource.file_size_mb}MB</span>
            </div>
            <div class="resource-meta">
                <span>${formatDate(resource.upload_date)}</span>
                <span>${escapeHtml(resource.uploader_name)}</span>
            </div>
            <div class="resource-actions">
                <button class="btn btn-sm btn-outline preview-btn" style="color: var(--vit-blue); border-color: var(--vit-blue);">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button class="btn btn-sm btn-primary download-btn">
                    <i class="fas fa-download"></i> Download
                </button>
                ${isAdmin ? `
                <button class="btn btn-sm btn-danger delete-btn" style="background: var(--vit-danger); color: white; border: none;">
                    <i class="fas fa-trash"></i> Delete
                </button>
                ` : ''}
            </div>
        </div>
    `;
    
    // Add event listeners to buttons
    const previewBtn = card.querySelector('.preview-btn');
    const downloadBtn = card.querySelector('.download-btn');
    const deleteBtn = card.querySelector('.delete-btn');
    
    previewBtn.addEventListener('click', () => previewResource(resource));
    downloadBtn.addEventListener('click', (event) => downloadResource(resource, event));
    
    if (deleteBtn) {
        deleteBtn.addEventListener('click', () => deleteResource(resource));
    }
    
    return card;
}

// Delete resource (admin only)
function deleteResource(resource) {
    if (!currentUser || currentUser.role !== 'admin') {
        showNotification('Admin access required to delete resources', 'error');
        return;
    }
    
    const confirmation = confirm(`Are you sure you want to delete "${resource.title}"? This action cannot be undone.`);
    
    if (!confirmation) {
        return;
    }
    
    const token = localStorage.getItem('authToken');
    
    fetch(`${API_BASE}/admin/resources/${resource.id}`, {
        method: 'DELETE',
        headers: {
            'Authorization': token
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(errorData => {
                throw new Error(errorData.message || 'Delete failed');
            });
        }
        return response.json();
    })
    .then(data => {
        showNotification('Resource deleted successfully!', 'success');
        // Reload resources to reflect changes
        loadResources();
        if (currentUser) {
            loadUserResources();
        }
    })
    .catch(error => {
        console.error('Delete error:', error);
        showNotification(error.message || 'Failed to delete resource', 'error');
    });
}

// Get file icon based on type
function getFileIcon(type) {
    const icons = {
        'notes': 'alt',
        'book': 'book',
        'paper': 'file-alt',
        'project': 'code',
        'other': 'file'
    };
    return icons[type] || 'file';
}

// Escape HTML to prevent XSS
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

// Filter resources
function filterResources() {
    loadResources();
}

// Update file info
function updateFileInfo() {
    if (resourceFile.files.length > 0) {
        const file = resourceFile.files[0];
        fileName.textContent = file.name;
        fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)}MB`;
        
        // Validate file type
        const fileExtension = file.name.split('.').pop().toLowerCase();
        const allowedExtensions = ['pdf', 'doc', 'docx', 'ppt', 'pptx', 'txt', 'zip'];
        if (!allowedExtensions.includes(fileExtension)) {
            showNotification('File type not allowed. Please select a valid file.', 'warning');
        }
    } else {
        fileName.textContent = 'No file chosen';
        fileSize.textContent = 'Max 25MB';
    }
}

// Handle resource upload
function handleResourceUpload(e) {
    e.preventDefault();
    
    if (!currentUser) {
        showNotification('Please login to upload resources', 'error');
        showAuthModal('login');
        return;
    }
    
    const title = document.getElementById('resourceTitle').value.trim();
    const description = document.getElementById('resourceDescription').value.trim();
    const course = document.getElementById('resourceCourse').value;
    const semester = document.getElementById('resourceSemester').value;
    const subject = document.getElementById('resourceSubject').value.trim();
    const type = document.getElementById('resourceType').value;
    const file = resourceFile.files[0];
    
    // Validation
    if (!title || !description || !course || !semester || !subject || !type || !file) {
        showNotification('Please fill all fields', 'error');
        return;
    }
    
    if (file.size > 25 * 1024 * 1024) {
        showNotification('File size must be less than 25MB', 'error');
        return;
    }
    
    showLoading(true);
    
    const formData = new FormData();
    formData.append('title', title);
    formData.append('description', description);
    formData.append('course', course);
    formData.append('semester', semester);
    formData.append('subject', subject);
    formData.append('type', type);
    formData.append('file', file);
    
    fetch(`${API_BASE}/resources/upload`, {
        method: 'POST',
        headers: {
            'Authorization': localStorage.getItem('authToken')
        },
        body: formData
    })
    .then(response => {
        if (!response.ok) throw new Error('Upload failed');
        return response.json();
    })
    .then(data => {
        if (data.message === 'Resource uploaded successfully') {
            showNotification('Resource uploaded successfully!', 'success');
            resourceUploadForm.reset();
            fileName.textContent = 'No file chosen';
            fileSize.textContent = 'Max 25MB';
            loadResources();
            updateDashboardStats();
        } else {
            showNotification(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Upload error:', error);
        showNotification('Upload failed. Please try again.', 'error');
    })
    .finally(() => {
        showLoading(false);
    });
}

// Preview resource
function previewResource(resource) {
    currentPreviewResource = resource;
    document.getElementById('previewTitle').textContent = resource.title;
    
    const previewBody = document.getElementById('previewBody');
    previewBody.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-file-${getFileIcon(resource.type)}" style="font-size: 64px; color: var(--vit-blue); margin-bottom: 20px;"></i>
            <h3>${escapeHtml(resource.title)}</h3>
            <p>${escapeHtml(resource.description)}</p>
            <div style="background: var(--vit-light-gray); padding: 15px; border-radius: 8px; margin-top: 20px; text-align: left;">
                <p><strong>Subject:</strong> ${escapeHtml(resource.subject)}</p>
                <p><strong>Course:</strong> ${getCourseName(resource.course)}</p>
                <p><strong>Semester:</strong> ${resource.semester}</p>
                <p><strong>Uploaded by:</strong> ${escapeHtml(resource.uploader_name)}</p>
                <p><strong>File size:</strong> ${resource.file_size_mb}MB</p>
                <p><strong>Downloads:</strong> ${resource.download_count || 0}</p>
                <p><strong>Uploaded:</strong> ${formatDate(resource.upload_date)}</p>
            </div>
        </div>
    `;
    
    previewModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// Get course name from code
function getCourseName(courseCode) {
    const courses = {
        'cse': 'Computer Science & Engineering',
        'ece': 'Electronics & Communication',
        'mech': 'Mechanical Engineering',
        'it': 'Information Technology'
    };
    return courses[courseCode] || courseCode;
}

// Hide preview modal
function hidePreviewModal() {
    previewModal.style.display = 'none';
    document.body.style.overflow = 'auto';
    currentPreviewResource = null;
}

// Handle download from preview modal
function handleDownloadPreview() {
    if (currentPreviewResource) {
        downloadResource(currentPreviewResource, null);
    }
}

// Download resource - Forces download without opening
function downloadResource(resource, event) {
    if (!currentUser) {
        showNotification('Please login to download resources', 'error');
        showAuthModal('login');
        return;
    }
    
    showNotification(`Preparing download for ${resource.title}...`, 'success');
    
    fetch(`${API_BASE}/resources/${resource.id}/download`, {
        method: 'POST',
        headers: {
            'Authorization': localStorage.getItem('authToken'),
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(errorData => {
                throw new Error(errorData.message || 'Download failed');
            });
        }
        return response.json();
    })
    .then(data => {
        // Create a hidden anchor tag to trigger download
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = data.download_url;
        
        // Set the proper filename
        const filename = resource.original_filename || 
                        `${resource.title.replace(/[^a-z0-9]/gi, '_')}.${getFileExtension(resource.type)}`;
        a.download = filename;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        hidePreviewModal();
        
        showNotification('Download started! Check your downloads folder.', 'success');
        
        // Update download count visually
        const downloadBtn = event ? event.target.closest('.download-btn') : null;
        if (downloadBtn) {
            const originalText = downloadBtn.innerHTML;
            downloadBtn.innerHTML = '<i class="fas fa-check"></i> Downloaded';
            downloadBtn.disabled = true;
            setTimeout(() => {
                downloadBtn.innerHTML = originalText;
                downloadBtn.disabled = false;
            }, 2000);
        }
    })
    .catch(error => {
        console.error('Download error:', error);
        showNotification(error.message || 'Download failed. Please try again.', 'error');
    });
}

// Helper function to get file extension based on type
function getFileExtension(type) {
    const extensions = {
        'notes': 'pdf',
        'book': 'pdf', 
        'paper': 'pdf',
        'project': 'zip',
        'other': 'pdf'
    };
    return extensions[type] || 'pdf';
}

// Check password strength
function checkPasswordStrength() {
    const password = signupPassword.value;
    let strength = 0;
    let message = '';
    let barColor = '';
    
    if (password.length > 5) strength += 20;
    if (password.length > 7) strength += 20;
    if (/[A-Z]/.test(password)) strength += 20;
    if (/[0-9]/.test(password)) strength += 20;
    if (/[^A-Za-z0-9]/.test(password)) strength += 20;
    
    if (password.length === 0) {
        message = '';
        barColor = '';
    } else if (strength < 40) {
        message = 'Weak';
        barColor = '#dc3545';
    } else if (strength < 80) {
        message = 'Medium';
        barColor = '#ffc107';
    } else {
        message = 'Strong';
        barColor = '#28a745';
    }
    
    passwordStrengthBar.style.width = `${strength}%`;
    passwordStrengthBar.style.background = barColor;
    passwordStrengthText.textContent = message;
    passwordStrengthText.style.color = barColor;
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>